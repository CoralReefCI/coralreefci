<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Heupr Console</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>

    <script>
    $(document).ready(function() {
      var animals = ["Bantha", "Eopie", "Dewback", "Ronto"]; // TEMPORARY
      var labels = '';
      for (i=0;i<animals.length;i++){
         labels += '<option value="'+ animals[i] + '">' + animals[i] + '</option>';
      }
      $(".selectpicker.labels").append(labels);
      var droids = ["R2-D2", "C-3P0"]; // TEMPORARY
      var repos = '';
      for (i=0;i<droids.length;i++){
        repos += '<option value="'+ droids[i] + '">' + droids[i] + '</option>';
      }
      $(".selectpicker.repos").append(repos);
    });
    </script>

    <style>
      .navbar {
        margin-bottom: 0;
        border-radius: 0;
        padding: 15px;
        background-color: #DC143C;
        border-color: #DC143C;
      }

      a.navbar-brand {
        color: #FFFFFF;
        font-weight: bold;
        text-decoration: none;
        font-size: 25px;
      }

      h2 {
        margin-top: 40px;
        margin-bottom: 30px;
      }

      h4 {
        margin-top: 20px;
      }

      .glyphicon-info-sign {
        color: #DC143C;
      }

      .bucket {
        margin-bottom: 10px;
      }

      .form-control {
        width: 220px;
        margin-bottom: 2px;
      }

      .btn {
        margin: 2px;
      }

      .btn-primary {
        margin-top: 10px;
      }

      li {
        margin: 4px;
      }

    </style>
  </head>
</html>

<nav class="navbar">
  <a class="navbar-brand" href="#">Heupr</a>
</nav>

<div>
  <div class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8">
      <form role="form" id="label-settings" action="#" method="POST" onsubmit="saveSettings(); return false">
      <script>
      function saveSettings() {
        var names = [];
        $(".col-sm-4.bucket").each(function() {
          names.push($(this).find(".form-control").val())
        });
        names.sort();
        var filtered = names.filter( function(v, i, a) {
          return !i || v !== a[i-1];
        });
        if (names.length != filtered.length) {
          alert("Please enter unique bucket descriptions");
          return;
        }
      }
      </script>
        <h2>Select Repo</h2>
        <div>
          <select class="selectpicker repos" data-live-search="true" title="Select repo"></select>
        </div>
        <h2>Label options</h2>
        <hr>
        <h4>
          <small>
            <span class="glyphicon glyphicon-info-sign" title="Applied to all newly raised issues"></span>
          </small> Default label(s)
        </h4>
        <div class="row" id="bucket-default">
          <div class="col-sm-4">
            <div>
              <select class="selectpicker labels" data-live-search="true" multiple="true" title="Select label(s)..."></select>
            </div>
          </div>
        </div>
        <h4>
          <small>
            <span class="glyphicon glyphicon-info-sign" title="Labels chosen by Heupr for newly raised issues"></span>
          </small> Dynamic label(s)
        </h4>
        <div class="row" id="bucket-row">
          <div class="col-sm-4 bucket">
            <div>
              <input class="form-control" type="text" name="description" placeholder="Bucket description">
            </div>

            <div>
              <select class="selectpicker labels" data-live-search="true" multiple="true" title="Select label(s)..."></select>
            </div>

            <small>
              <span class="glyphicon glyphicon-info-sign" title="Add another class of labels"></span>
            </small>

            <span>
              <button class="btn btn-primary" type="button" onclick="addBucket()">Add bucket</button>
            </span>
            <script>
            function addBucket() {
              var cln = $(".bucket:first").clone();
              cln.appendTo("#bucket-row");
              cln.find(".form-control").val("");
              cln.find(".bootstrap-select").replaceWith(function() { return $("select", this); });
              cln.find("select").selectpicker();
            }
            </script>

            <small>
              <span class="glyphicon glyphicon-info-sign" title="Remove this class of labels"></span>
            </small>

            <span>
              <button class="btn btn-primary" type="button" onclick="removeBucket(this)">Remove bucket</button>
            </span>
            <script>
            function removeBucket(elmnt) {
              var lst = document.getElementById("bucket-row");
              var cnt = lst.childElementCount;
              if (cnt == 1) {
                alert("Cannot remove bucket");
              } else {
                var inpt = confirm("Are you sure you want to remove the bucket?");
                if (inpt == true) {
                  lst.removeChild(elmnt.parentElement.parentElement);
                }
              }
            }
            </script>
          </div>
        </div>
        <br>
        <input type="submit" class="btn btn-primary" value="Save">
      </form>
    </div>
    <div class="col-sm-2"></div>
  </div>
</div>
